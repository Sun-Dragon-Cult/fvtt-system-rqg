{{log "Weapon Sheet" this}}
<form class="{{cssClass}}" autocomplete="off">
  <header class="sheet-header">
    <img class="profile-img" src="{{data.img}}" data-edit="img" title="{{data.name}}" />
    <input type="text" name="name" value="{{data.name}}" />
    <label>Enc <input type="number" min="0" max="999999" name="data.encumbrance" value="{{weaponData.encumbrance}}"></label><br>
    <select name="data.equippedStatus">
      {{#select weaponData.equippedStatus}} {{#each sheetSpecific.equippedStatuses}}
      <option value="{{this}}">{{localize (concat "RQG.EquippedStatus." this)}}</option>
      {{/each}} {{/select}}
    </select>
  </header>
  <main>
    <div>
      <label>HP <input type="number" min="0" max="99" name="data.hitPoints.max" value="{{weaponData.hitPoints.max}}"></label><br>
      <label>Current HP <input type="number" min="0" max="99" name="data.hitPoints.value" value="{{weaponData.hitPoints.value}}"></label><br>
      <label><input type="checkbox" name="data.isNatural" {{checked weaponData.isNatural}}/>Is natural weapon</label><br>
      <label>Price (real) <input type="number" min="0" max="99999999" name="data.price.real" value="{{weaponData.price.real}}">(L)</label><br>
      <label>Price (estimated) <input type="number" min="0" max="99999999" name="data.price.estimated" value="{{weaponData.price.estimated}}">(L)</label><br>
      <label>Location <input type="text" name="data.location" value="{{weaponData.location}}"></label><br>
      <label>Attuned to <input type="text" name="data.attunedTo" value="{{weaponData.attunedTo}}"></label><br>

      <fieldset>
        <legend>Melee Weapon settings</legend>
        <label>SR <input type="number" min="0" max="99" name="data.strikeRank" value="{{weaponData.strikeRank}}"></label><br>
      </fieldset>
      <fieldset>
        <legend>Missile Weapon settings</legend>
<span>TODO add the settings here</span>
      </fieldset>

    </div>
    <br>
    <h3>Uses of Weapon</h3>
    <div class="flex-row flex-wrap">
        {{#each weaponData.usage}}
          <fieldset data-dropzone="{{@key}}">
          <legend>{{@key}}</legend>
            {{#if combatManeuvers}}
          {{#if isEmbedded}}
            <select name="data.skillId">
              {{#select skillId}} {{#each weaponSkills}}
                <option value="{{id}}">{{name}}</option>
              {{/each}} {{/select}}
            </select>
          {{else}}
            <label class="mp">Skill</label><br>
            {{#if @root.sheetSpecific.skillNames}}
              {{lookup @root.sheetSpecific.skillNames @key}}<br><i>(Drop some other weapon skill on this weapon to change)</i>
            {{else}}
              <i>Drop a weapon skill on this weapon!</i>
            {{/if}}<br>
          {{/if}}<br>
            <div class="flex-row">
              <label>Damage <input type="text" name="data.usage.{{@key}}.damage" value="{{damage}}"></label>
              <label>Min STR <input type="number" min="0" max="99" name="data.usage.{{@key}}.minStrength" value="{{minStrength}}"></label>
              <label>Min DEX <input type="number" min="0" max="99" name="data.usage.{{@key}}.minDexterity" value="{{minDexterity}}"></label>
            </div><br>
            {{/if}}
            <div>
              <h3>Combat Manuevers</h3>
              <table>
                <tr>
                  <th>Label</th>
                  <th>Damage Type</th>
                </tr>
                {{setVar 'usage' @key this}}
                {{#each combatManeuvers}}
                  {{log "combatManeuver" ../this}}
                  <tr>
                    <td><input type="text" list="defaultCombatManeuverNames" name="data.usage.{{../usage}}.combatManeuvers.name" value="{{name}}"></td>
                    <td>
                      {{#if name}}
                      <select name="data.usage.{{../usage}}.combatManeuvers.damageTypes">
                        {{#select damageType}} {{#each @root.sheetSpecific.damageTypes}}
                          <option value="{{this}}">{{this}}</option>
                        {{/each}} {{/select}}
                      </select>
                      {{/if}}
                    </td>
                    <td>
                        <textarea {{#unless (eq damageType "special")}}class="no-display"{{/unless}} rows="1" name="data.usage.{{../usage}}.combatManeuvers.description" placeholder="Description of how this attack works">{{description}}</textarea>
                    </td>
                  </tr>
                {{/each}}
                <tr>
                  <td><input type="text" list="defaultCombatManeuverNames" name="data.usage.{{usage}}.combatManeuvers.name"></td>
                </tr>
              </table>
            </div>
          </fieldset>
        {{/each}}

    </div>

    <label>Description {{editor content=weaponData.description target="data.description"
      button=true owner=owner editable=editable}}
    </label><br>
    <label>GM Notes {{editor content=weaponData.gmNotes target="data.gmNotes"
      button=true owner=owner editable=editable}}
    </label>
    <br>{{> "systems/rqg/items/sheet-parts/itemActiveEffects.html"}}
  </main>
  <datalist id="defaultCombatManeuverNames">
    {{#each sheetSpecific.defaultCombatManeuverNames}}
      <option value="{{this}}">{{this}}</option>
    {{/each}}
  </datalist>
</form>
