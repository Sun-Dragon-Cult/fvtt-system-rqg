<form class="{{cssClass}}" autocomplete="off">
  {{!-- Sheet Header --}}
  <header class="sheet-header">
    <img
      class="profile-img"
      src="{{actor.img}}"
      data-edit="img"
      title="{{actor.name}}"
    />
    <div>
      <div class="topheaderline">
        <h1 class="charname norse">
          <input
            name="name"
            type="text"
            value="{{actor.name}}"
            placeholder=""
          />
        </h1>
      </div>
      <div class="characteristics">
        {{#each data.characteristics as | characteristic key |}}
        <div>
          <label class="resource-label norse"
            >{{localize (concat 'characteristic.' key)}}</label
          ><br />
          <input
            type="number"
            min="0"
            max="99"
            name="data.characteristics.{{key}}.value"
            value="{{characteristic.value}}"
            data-dtype="Number"
            size="2"
          />
        </div>
        {{/each}}
      </div>
      <div class="thirdline">
        <div>
          <span class="norse">SIZ SR</span> {{data.attributes.sizStrikeRank}}
        </div>
        <div>
          <span class="norse">DEX SR</span> {{data.attributes.dexStrikeRank}}
        </div>
        <div>
          <span class="norse">Max ENC</span>
          {{data.attributes.maximumEncumbrance}}
        </div>
        <div>
          <span class="norse">Equipped ENC</span>
          {{data.attributes.equippedEncumbrance}}
        </div>
        <div>
          <span class="norse">Travel ENC</span>
          {{data.attributes.travelEncumbrance}}
        </div>
        <div>
          <span class="norse">MOV</span>
          {{data.attributes.movementRate}}
        </div>
      </div>
    </div>
  </header>
  <div class="runeline">
    <img src="systems/rqg/assets/icons/runes/mastery.svg" />
    <img src="systems/rqg/assets/icons/runes/magic.svg" />
    <img src="systems/rqg/assets/icons/runes/disorder.svg" />
    <img src="systems/rqg/assets/icons/runes/movement_change.svg" />
    <img src="systems/rqg/assets/icons/runes/moon_full.svg" />
    <img src="systems/rqg/assets/icons/runes/spirit.svg" />
    <img src="systems/rqg/assets/icons/runes/death.svg" />
    <img src="systems/rqg/assets/icons/runes/illusion.svg" />
    <img src="systems/rqg/assets/icons/runes/dragonnewt.svg" />
    <img src="systems/rqg/assets/icons/runes/darkness.svg" />
    <img src="systems/rqg/assets/icons/runes/truth.svg" />
    <img src="systems/rqg/assets/icons/runes/stasis.svg" />
    <img src="systems/rqg/assets/icons/runes/luck.svg" />
    <img src="systems/rqg/assets/icons/runes/plant.svg" />
    <img src="systems/rqg/assets/icons/runes/water.svg" />
    <img src="systems/rqg/assets/icons/runes/beast.svg" />
    <img src="systems/rqg/assets/icons/runes/air.svg" />
    <img src="systems/rqg/assets/icons/runes/man.svg" />
    <img src="systems/rqg/assets/icons/runes/earth.svg" />
    <img src="systems/rqg/assets/icons/runes/harmony.svg" />
    <img src="systems/rqg/assets/icons/runes/fertility.svg" />
    <img src="systems/rqg/assets/icons/runes/fate.svg" />
    <img src="systems/rqg/assets/icons/runes/chaos.svg" />
  </div>

  <div class="flex-row flex-wrap">
    {{> "systems/rqg/actors/parts/health.html" }}
    <div>
      <h2 class="norse">Combat</h2>
      <div class="flexrow flex-align-center">
        <label class="norse">Damage Bonus {{data.attributes.damageBonus}}</label>
        <a class="text-right norse" data-item-id="{{this.data.dodgeSkill._id}}" data-item-roll>Dodge {{skillchance this.data.dodgeSkill._id this.actor._id}}%</a>
      </div>
      <table>
        <thead>
          <tr>
            <th class="text-left">Weapon</th>
            <th class="text-right">Chance</th>
            <th class="text-left">Exp</th>
            <th class="text-left" colspan="2">HP</th>
            <th class="text-left">Combat Maneuvers</th>
          </tr>
        </thead>
        <tbody>
        {{#each data.ownedItems.meleeWeapon}}
          {{#if this.data.data.isEquipped}}
          {{#unless this.data.data.isNatural}}
          <tr data-skill-id="{{data.data.skillId}}" data-item-id="{{data._id}}">
            <td>{{this.name}}</td>
            <td class="text-right">{{skillchance this.data.data.skillId this.actor._id}}%</td>
            <td data-item-id="{{data.data.skillId}}"><input type="checkbox" data-item-experience {{checkedexperience this.data.data.skillId this.actor._id}}></td>
            <td class="text-right"><input type="number" data-dtype="Number" data-item-edit-value="data.hitPoints.value" value="{{this.data.data.hitPoints.value}}"> /</td>
            <td class="text-right">{{this.data.data.hitPoints.max}}</td>
            <td class="text-left">
              {{#each this.data.data.combatManeuvers}}
              <a data-melee-roll="{{this}}">{{this}}</a>
              {{/each}}
            </td>
          </tr>
          {{/unless}}
          {{/if}}
        {{/each}}

        {{#each data.ownedItems.meleeWeapon}}
          {{#if this.data.data.isNatural}}
          <tr data-skill-id="{{data.data.skillId}}" data-item-id="{{data._id}}">
            <td>{{this.name}}</td>
            <td class="text-right">{{skillchance this.data.data.skillId this.actor._id}}%</td>
            <td data-item-id="{{data.data.skillId}}"><input type="checkbox" data-item-experience {{checkedexperience this.data.data.skillId this.actor._id}}></td>
            <td></td>
            <td></td>
            <td class="text-left">
              {{#each this.data.data.combatManeuvers}}
              <a data-melee-roll="{{this}}">{{this}}</a>
              {{/each}}
            </td>
          </tr>
          {{/if}}
        {{/each}}

        {{#each data.ownedItems.missileWeapon}}
          {{#if this.data.data.isEquipped}}
          {{#if (or this.data.data.isProjectileWeapon this.data.data.isThrownWeapon)}}
          <tr data-skill-id="{{data.data.skillId}}" data-item-id="{{data._id}}">
            <td>{{this.name}} ({{quantity this.data.data.projectileId this.actor._id}})</td>
            <td class="text-right">{{skillchance this.data.data.skillId this.actor._id}}%</td>
            <td data-item-id="{{data.data.skillId}}"><input type="checkbox" data-item-experience {{checkedexperience this.data.data.skillId this.actor._id}}></td>
            <td></td>
            <td></td>
            <td class="text-left">
              {{#each this.data.data.combatManeuvers}}
              <a data-missile-roll="{{this}}">{{this}}</a>
              {{/each}}
            </td>
          </tr>
          {{/if}}
          {{/if}}
        {{/each}}
        </tbody>
      </table>
      <!-- TODO Show Dodge skill & maybe knockback? -->
      <!-- TODO Show spells for easy access? -->
      <div>
        <h2 class="norse">Spirit Combat</h2>
        <div class="flexrow nowrap flex-align-center">
          <label class="mp norse">Magic Points <input
              type="number"
              min="0"
              max="99"
              name="data.attributes.magicPoints.value"
              value="{{data.attributes.magicPoints.value}}"
              data-dtype="Number"
              size="2"
            /> / {{data.attributes.magicPoints.max}}
          </label>
          <label class="norse text-right">Spirit Combat Damage {{data.attributes.spiritCombatDamage}}</label>
        </div>
        <table>
          <tr data-item-id="{{this.data.spiritCombatSkill._id}}">
            <td>Spirit Combat</td>
            <td class="text-right" data-item-roll><a>{{skillchance this.data.spiritCombatSkill._id this.actor._id}}%</a></td>
          </tr>
        </table>
      </div>
    </div>
  </div>

  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item norse" data-tab="runes">Runes</a>
    <a class="item norse" data-tab="spiritmagic">Spirit Magic</a>
    <a class="item norse" data-tab="runemagic">Rune Magic</a>
    <a class="item norse" data-tab="sorcery">Sorcery</a>
    <a class="item norse" data-tab="skills">Skills</a>
    <a class="item norse" data-tab="gear">Gear</a>
    <a class="item norse" data-tab="passions">Passions</a>
    <a class="item norse" data-tab="background">Background</a>
    <a class="item norse" data-tab="activeeffectstesting">ðŸ§ªActive Effects</a>
  </nav>

  <section class="sheet-body">
    <div class="tab runes" data-group="primary" data-tab="runes">
      {{> "systems/rqg/actors/parts/runes-tab.html" }}
    </div>

    <div class="tab spiritmagic" data-group="primary" data-tab="spiritmagic">
      {{> "systems/rqg/actors/parts/spirit-magic-tab.html" }}
    </div>

    <div class="tab runemagic" data-group="primary" data-tab="runemagic">
      {{> "systems/rqg/actors/parts/rune-magic-tab.html" }}
    </div>

    <div class="tab sorcery" data-group="primary" data-tab="sorcery">
      {{> "systems/rqg/actors/parts/sorcery-tab.html" }}
    </div>

    <div class="tab skills" data-group="primary" data-tab="skills">
      {{> "systems/rqg/actors/parts/skills-tab.html" }}
    </div>

    <div class="tab gear" data-group="primary" data-tab="gear">
      {{> "systems/rqg/actors/parts/gear-tab.html" }}
    </div>

    <div class="tab passions" data-group="primary" data-tab="passions">
      {{> "systems/rqg/actors/parts/passions-tab.html" }}
    </div>

    <div class="tab background" data-group="primary" data-tab="background">
      {{> "systems/rqg/actors/parts/background-tab.html" }}
    </div>

    {{!-- TEMPORARY Active Effects Testing Tab --}}
    <div class="tab activeeffectstesting" data-group="primary" data-tab="activeeffectstesting">
      {{> "systems/rqg/actors/parts/activeeffectstesting-tab.html" }}
    </div>
  </section>
</form>
