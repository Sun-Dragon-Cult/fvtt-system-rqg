<form class="{{cssClass}}" autocomplete="off">
  {{!-- Sheet Header --}}
  <header class="sheet-header">
    <img
      class="profile-img"
      src="{{actor.img}}"
      data-edit="img"
      title="{{actor.name}}"
    />
    <div>
      <div class="topheaderline">
        <h1 class="charname norse">
          <input
            name="name"
            type="text"
            value="{{actor.name}}"
            placeholder=""
          />
        </h1>
      </div>
      <div class="characteristics">
        {{#each data.characteristics as | characteristic key |}}
        <div>
          <label class="resource-label norse"
            >{{localize (concat 'characteristic.' key)}}</label
          ><br />
          <input
            type="number"
            min="0"
            max="99"
            name="data.characteristics.{{key}}.value"
            value="{{characteristic.value}}"
            size="2"
          />
        </div>
        {{/each}}
      </div>
      <div class="thirdline">
        <div>
          <span class="norse">SIZ SR</span> {{data.attributes.sizStrikeRank}}
        </div>
        <div>
          <span class="norse">DEX SR</span> {{data.attributes.dexStrikeRank}}
        </div>
        <div>
          <span class="norse">Max ENC</span>
          {{data.attributes.maximumEncumbrance}}
        </div>
        <div>
          <span class="norse">Equipped ENC</span>
          {{data.attributes.equippedEncumbrance}}
        </div>
        <div>
          <span class="norse">Travel ENC</span>
          {{data.attributes.travelEncumbrance}}
        </div>
        <div>
          <span class="norse">MOV</span>
          {{data.attributes.move}}
        </div>
      </div>
    </div>
  </header>
  <div class="runeline">
  </div>

  <div class="flex-row flex-wrap">
    {{> "systems/rqg/actors/parts/health.html" }}
    <div>
      <h2 class="norse">Combat</h2>
      <div class="flexrow flex-align-center">
        <label class="norse">Damage Bonus {{data.attributes.damageBonus}}</label>
        <a class="text-right norse" data-item-id="{{data.dodgeSkill._id}}" data-item-roll>Dodge {{skillchance data.dodgeSkill._id actor._id}}%</a>
      </div>
      <table>
        <thead>
          <tr>
            <th class="text-left">Weapon</th>
            <th class="text-right">Chance</th>
            <th class="text-left">Exp</th>
            <th class="text-left" colspan="2">HP</th>
            <th class="text-right">SR</th>
            <th class="text-left">Combat Maneuvers</th>
          </tr>
        </thead>
        <tbody>
        {{#each data.ownedItems.meleeWeapon}}
          {{#if data.data.isEquipped}}
          {{#unless data.data.isNatural}}
          <tr data-skill-id="{{data.data.skillId}}" data-item-id="{{data._id}}">
            <td>{{name}}</td>
            <td class="text-right">{{skillchance data.data.skillId actor._id}}%</td>
            <td data-item-id="{{data.data.skillId}}"><input type="checkbox" data-item-experience {{checkedexperience data.data.skillId actor._id}}></td>
            <td class="text-right"><input type="number" min="-99" max="99" data-item-edit-value="data.hitPoints.value" value="{{data.data.hitPoints.value}}"> /</td>
            <td class="text-right">{{data.data.hitPoints.max}}</td>
            <td class="text-right">{{data.data.strikeRank}}</td>
            <td class="text-left">
              {{#each data.data.combatManeuvers}}
              <a data-melee-roll="{{this}}">{{this}}</a>
              {{/each}}
            </td>
          </tr>
          {{/unless}}
          {{/if}}
        {{/each}}

        {{#each data.ownedItems.missileWeapon}}
        {{#if data.data.isEquipped}}
        {{#if (or data.data.isProjectileWeapon data.data.isThrownWeapon)}}
        <tr data-skill-id="{{data.data.skillId}}" data-item-id="{{data._id}}">
          <td>{{name}} ({{quantity data.data.projectileId actor._id}})</td>
          <td class="text-right">{{skillchance data.data.skillId actor._id}}%</td>
          <td data-item-id="{{data.data.skillId}}"><input type="checkbox" data-item-experience {{checkedexperience data.data.skillId actor._id}}></td>
          <td></td>
          <td></td>
          <td></td>
          <td class="text-left">
            {{#each data.data.combatManeuvers}}
            <a data-missile-roll="{{this}}">{{this}}</a>
            {{/each}}
          </td>
        </tr>
        {{/if}}
        {{/if}}
        {{/each}}

        {{#each data.ownedItems.meleeWeapon}}
          {{#if data.data.isNatural}}
          <tr data-skill-id="{{data.data.skillId}}" data-item-id="{{data._id}}">
            <td>{{name}}</td>
            <td class="text-right">{{skillchance data.data.skillId actor._id}}%</td>
            <td data-item-id="{{data.data.skillId}}"><input type="checkbox" data-item-experience {{checkedexperience data.data.skillId actor._id}}></td>
            <td></td>
            <td></td>
            <td class="text-right">{{data.data.strikeRank}}</td>
            <td class="text-left">
              {{#each data.data.combatManeuvers}}
              <a data-melee-roll="{{this}}">{{this}}</a>
              {{/each}}
            </td>
          </tr>
          {{/if}}
        {{/each}}
        </tbody>
      </table>
      <div>
        <h2 class="norse">Spirit Combat</h2>
        <div class="flexrow nowrap flex-align-center">
          <label class="mp norse">Magic Points <input
              type="number"
              min="0"
              max="99"
              name="data.attributes.magicPoints.value"
              value="{{data.attributes.magicPoints.value}}"
              size="2"
            /> / {{data.attributes.magicPoints.max}}
          </label>
          <i>{{#each data.powCrystals}}
          {{name}}({{size}}MP)<br>
            {{/each}}</i>
          <label class="norse text-right">Spirit Combat Damage {{data.attributes.spiritCombatDamage}}</label>
        </div>
        <table>
          <tr data-item-id="{{data.spiritCombatSkill._id}}">
            <td>Spirit Combat</td>
            <td class="text-right" data-item-roll><a>{{skillchance data.spiritCombatSkill._id actor._id}}%</a></td>
          </tr>
        </table>
      </div>
    </div>
  </div>

  <nav class="sheet-tabs tabs" data-group="primary">
    <a class="item norse" data-tab="runes">Runes</a>
    <a class="item norse" data-tab="spiritmagic">Spirit Magic</a>
    <a class="item norse" data-tab="runemagic">Rune Magic</a>
    <a class="item norse" data-tab="sorcery">Sorcery</a>
    <a class="item norse" data-tab="skills">Skills</a>
    <a class="item norse" data-tab="gear">Gear</a>
    <a class="item norse" data-tab="passions">Passions</a>
    <a class="item norse" data-tab="background">Background</a>
    <a class="item norse" data-tab="activeeffectstesting">ðŸ§ªActive Effects</a>
  </nav>

  <section class="sheet-body">
    <div class="tab runes" data-group="primary" data-tab="runes">
      {{> "systems/rqg/actors/parts/runes-tab.html" }}
    </div>

    <div class="tab spiritmagic" data-group="primary" data-tab="spiritmagic">
      {{> "systems/rqg/actors/parts/spirit-magic-tab.html" }}
    </div>

    <div class="tab runemagic" data-group="primary" data-tab="runemagic">
      {{> "systems/rqg/actors/parts/rune-magic-tab.html" }}
    </div>

    <div class="tab sorcery" data-group="primary" data-tab="sorcery">
      {{> "systems/rqg/actors/parts/sorcery-tab.html" }}
    </div>

    <div class="tab skills" data-group="primary" data-tab="skills">
      {{> "systems/rqg/actors/parts/skills-tab.html" }}
    </div>

    <div class="tab gear" data-group="primary" data-tab="gear">
      {{> "systems/rqg/actors/parts/gear-tab.html" }}
    </div>

    <div class="tab passions" data-group="primary" data-tab="passions">
      {{> "systems/rqg/actors/parts/passions-tab.html" }}
    </div>

    <div class="tab background" data-group="primary" data-tab="background">
      {{> "systems/rqg/actors/parts/background-tab.html" }}
    </div>

    {{!-- TEMPORARY Active Effects Testing Tab --}}
    <div class="tab activeeffectstesting" data-group="primary" data-tab="activeeffectstesting">
      {{> "systems/rqg/actors/parts/activeeffectstesting-tab.html" }}
    </div>
  </section>
</form>
