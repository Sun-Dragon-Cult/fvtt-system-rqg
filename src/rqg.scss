@use "variables";

body {
  background-attachment: fixed !important;
  background-size: cover !important;
  background: url("assets/images/ui/sacred-time.webp") no-repeat;
}

::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}
::-webkit-scrollbar-track {
  box-shadow: 0 0 1px #999 inset;
  border-radius: 4px;
}
::-webkit-scrollbar-thumb {
  outline: none;
  border-radius: 3px;
  background: var(--rqg-color-main-bg);
  border: 1px solid var(--rqg-color-main);
}
:root {
  scrollbar-width: thin;
  scrollbar-color: var(--rqg-color-main-bg) #111;
}

@font-face {
  font-family: Norse;
  src: url("assets/fonts/Norse-KaWl.otf") format("opentype");
}

@font-face {
  font-family: Norse;
  font-weight: bold;
  src: url("assets/fonts/NorseBold-2Kge.otf") format("opentype");
}

.norse {
  font-family: "Norse", "Signika", "Palatino Linotype", serif;
  font-variant: small-caps;
  letter-spacing: 1.5px;
}

.pad-left {
  padding-left: 10px !important;
}

.text-left {
  text-align: left;
}

.text-right {
  text-align: right;
  margin-left: auto;
}

.text-center {
  text-align: center;
  margin-left: auto;
  margin-right: auto;
}

.large-font {
  font-size: 1.2rem;
}

.small-size {
  font-size: small;
}

.x-small-size {
  font-size: x-small;
}

.rqg {
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-family: "Norse", "Signika", "Palatino Linotype", serif;
    font-variant: small-caps;
    letter-spacing: 1.5px;
    font-weight: bold;

    &.window-title {
      font-family: revert;
      font-variant: revert;
      letter-spacing: revert;
      font-weight: revert;
    }
  }

  .flex-row {
    display: flex;
    justify-content: space-between;
    gap: 0.5rem;

    > * {
      height: 100%;
    }
  }

  .flex-row-start {
    display: flex;
    justify-content: flex-start;
  }

  .flex-column {
    display: flex;
    flex-direction: column;
  }

  .flex-wrap {
    flex-wrap: wrap;
  }

  .flex-align-center {
    align-items: center;
  }

  .flex-align-end {
    align-items: flex-end;
  }

  .flex-1 {
    flex: 1;
  }

  .no-display {
    display: none;
  }

  .drag-hover {
    outline: forestgreen dashed 5px;
  }

  .gap1rem {
    gap: 1rem;
  }

  .gap03rem {
    gap: 0.3rem;
  }

  .warning {
    outline: 2px dashed var(--rqg-color-enc-warning);
    background-color: var(--rqg-color-enc-warning);
  }

  .mov-enc {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 0.75rem;
    padding: 0 5px 2px;
    margin: -12px 0 0;
    background-color: var(--rqg-color-enc-bg);
    border: none;

    legend {
      background-color: var(--rqg-color-enc-legend);
      padding: 0 15px;
      margin: 0 auto -4px;
      border-radius: 50%;
    }
  }

  .mp-ellipses {
    text-overflow: ellipsis;
    max-width: 7rem;
    white-space: nowrap;
    overflow: hidden;
    display: inline-block;
  }

  .masonry {
    display: block;
    columns: 12rem auto;
    gap: 1.5rem;
  }

  .masonry-item {
    page-break-inside: avoid;
    break-inside: avoid;
  }

  .nowrap {
    white-space: nowrap;
  }

  input[type="number"] {
    width: auto;
  }

  input[type="checkbox"] {
    flex: 0 0 12px;
    width: 12px;
    height: 12px;
    margin: 3px 3px;
  }

  input[type="submit"] {
    width: 100%;
    margin: 0 1px;
    background: rgba(0, 0, 0, 0.1);
    border: 2px groove var(--color-text-light-highlight);
    border-radius: 3px;
    font-size: 14px;
    line-height: 28px;
    font-family: var(--font-primary);
  }

  .ml-5 {
    margin-left: 5px;
  }

  .topheaderline {
    .charname {
      display: inline;
      justify-content: space-around;
    }

    img.rune {
      height: 30px;
    }
  }

  .tab.gear {
    article {
      margin-bottom: 0.7rem;
    }

    .gear-wrapper {
      flex-wrap: wrap;
      margin-left: -16px;
      margin-right: -16px;

      article {
        margin-left: 16px;
        margin-right: 16px;
      }
    }
  }

  .grid {
    display: grid;
    grid-template-rows: [row-start] min-content [row-end];
    grid-auto-rows: auto;
    grid-auto-columns: auto;
    grid-gap: 0;

    > * {
      padding: 2px;
      position: relative;
      display: flex;
      align-items: center;
    }

    .fullrow {
      grid-column: 1 / -1;
    }

    .headings {
      grid-column: 1/-1;
      grid-row: 1/2;

      background: var(--rqg-color-main-bg);
      mix-blend-mode: color-burn;
      text-shadow: 3px 4px 4px var(--rqg-color-grid-text-shadow);
      box-shadow: var(--rqg-box-shadow-grid-header);
      border: 3px double grey;
      border-radius: 40px;
      margin-left: -0.4rem;
      margin-right: -0.4rem;
    }

    .footer {
      grid-column: 1/-1;
      grid-row: auto;
      margin-top: -1.3rem;
      background: var(--rqg-color-main-bg);
      mix-blend-mode: color-burn;
      text-shadow: 3px 4px 4px var(--rqg-color-grid-text-shadow);
      box-shadow: var(--rqg-box-shadow-grid-header);
      border: 1px solid grey;
      border-radius: 40px;
      margin-left: -0.4rem;
      margin-right: -0.4rem;
    }

    .head1 {
      grid-row: 1;
      grid-column: 1/2;
    }

    .head2 {
      grid-row: 1;
      grid-column: 2/3;
    }

    .head3 {
      grid-row: 1;
      grid-column: 3/4;
    }

    .head4 {
      grid-row: 1;
      grid-column: 4/5;
    }

    .head5 {
      grid-row: 1;
      grid-column: 5/6;
    }

    .head6 {
      grid-row: 1;
      grid-column: 6/7;
    }

    .head7 {
      grid-row: 1;
      grid-column: 7/8;
    }

    .head8 {
      grid-row: 1;
      grid-column: 8/9;
    }

    .head9 {
      grid-row: 1;
      grid-column: 9/10;
    }

    .head10 {
      grid-row: 1;
      grid-column: 10/11;
    }

    .head11 {
      grid-row: 1;
      grid-column: 11/12;
    }

    .head1-4 {
      grid-row: 1;
      grid-column: 1 / span 4;
    }

    .no-background {
      background-color: transparent !important;
    }

    &.spirit-combat {
      grid-template-columns: [col-start] auto auto [col-end];

      // Alternating row background
      > *:nth-child(4n + 1),
      > *:nth-child(4n + 2) {
        background: var(--rqg-table-alternate-background);
      }
    }

    &.combat {
      grid-template-columns: [col-start] 30px repeat(5, auto) [col-end];

      // Alternating row background
      > *:nth-child(12n + 14),
      > *:nth-child(12n + 15),
      > *:nth-child(12n + 16),
      > *:nth-child(12n + 17),
      > *:nth-child(12n + 18),
      > *:nth-child(12n + 19) {
        background: var(--rqg-table-alternate-background);
      }

      // Set-token-SR-in-combat button
      button {
        height: 1.5rem;
        line-height: unset;
        width: unset;
        text-align: left;
      }

      .usage {
        line-height: 1.5rem;
        &.missile {
          line-height: 3rem;
        }
      }
    }

    &.spiritmagic {
      grid-template-columns: [col-start] 30px auto repeat(7, min-content) [col-end];

      // Alternating row background for 9 columns
      > *:nth-child(18n + 20),
      > *:nth-child(18n + 21),
      > *:nth-child(18n + 22),
      > *:nth-child(18n + 23),
      > *:nth-child(18n + 24),
      > *:nth-child(18n + 25),
      > *:nth-child(18n + 26),
      > *:nth-child(18n + 27),
      > *:nth-child(18n + 28) {
        background: var(--rqg-table-alternate-background);
      }
    }

    &.gear {
      grid-template-columns: [col-start] 30px auto repeat(5, max-content) [col-end];

      // Alternating row background for 7 columns
      > *:nth-child(14n + 16),
      > *:nth-child(14n + 17),
      > *:nth-child(14n + 18),
      > *:nth-child(14n + 19),
      > *:nth-child(14n + 20),
      > *:nth-child(14n + 21),
      > *:nth-child(14n + 22) {
        background: var(--rqg-table-alternate-background);
      }
    }

    .usagecontainer {
      display: block;
    }

    .usagecell {
      padding-top: 4px;
    }

    &.weapon {
      grid-template-columns: [col-start] 30px auto auto repeat(8, max-content) [col-end];

      // Alternating row background for 11 columns
      > *:nth-child(22n + 24),
      > *:nth-child(22n + 25),
      > *:nth-child(22n + 26),
      > *:nth-child(22n + 27),
      > *:nth-child(22n + 28),
      > *:nth-child(22n + 29),
      > *:nth-child(22n + 30),
      > *:nth-child(22n + 31),
      > *:nth-child(22n + 32),
      > *:nth-child(22n + 33),
      > *:nth-child(22n + 34) {
        background: var(--rqg-table-alternate-background);
      }
    }

    &.armor {
      grid-template-columns: [col-start] 30px auto min-content auto repeat(5, max-content) [col-end];

      > *:nth-child(18n + 20),
      > *:nth-child(18n + 21),
      > *:nth-child(18n + 22),
      > *:nth-child(18n + 23),
      > *:nth-child(18n + 24),
      > *:nth-child(18n + 25),
      > *:nth-child(18n + 26),
      > *:nth-child(18n + 27),
      > *:nth-child(18n + 28) {
        background: var(--rqg-table-alternate-background);
      }
    }

    &.rune-magic {
      grid-template-columns: [col-start] 30px auto repeat(8, max-content) [col-end];

      > *:nth-child(20n + 22),
      > *:nth-child(20n + 23),
      > *:nth-child(20n + 24),
      > *:nth-child(20n + 25),
      > *:nth-child(20n + 26),
      > *:nth-child(20n + 27),
      > *:nth-child(20n + 28),
      > *:nth-child(20n + 29),
      > *:nth-child(20n + 30),
      > *:nth-child(20n + 31) {
        background: var(--rqg-table-alternate-background);
      }
    }

    &.hit-location {
      grid-template-columns: [col-start] repeat(3, min-content) repeat(4, auto) [col-end];

      > *:nth-child(14n + 13),
      > *:nth-child(14n + 14),
      > *:nth-child(14n + 15),
      > *:nth-child(14n + 16),
      > *:nth-child(14n + 17),
      > *:nth-child(14n + 18),
      > *:nth-child(14n + 19) {
        background: var(--rqg-table-alternate-background);
      }
    }

    &.skill {
      grid-template-columns: [col-start] 30px auto min-content [col-end];

      // Alternating row background
      > *:nth-child(6n + 1),
      > *:nth-child(6n + 2),
      > *:nth-child(6n + 3) {
        background: var(--rqg-table-alternate-background);
      }
    }

    &.passions {
      display: grid;
      grid-template-rows: [row-start] auto [row-end];
      grid-auto-rows: auto;
      grid-auto-columns: auto;
      grid-gap: 0;
      grid-template-columns: [col-start] auto [col-end];

      // Alternating row background
      > *:nth-child(2n + 1) {
        background: var(--rqg-table-alternate-background);
      }

      .grid.passion {
        display: grid;
        grid-template-columns: [col-start] 45px [description-start] auto min-content [description-end col-end];
        grid-template-rows: [row-start] auto [row-end description-start] auto [description-end];
      }

      .description {
        grid-area: description;
      }

      .img {
        grid-row: 1 / -1;
        img {
          mix-blend-mode: soft-light;
        }
      }
    }

    &.rune {
      grid-template-columns: [col-start] max-content auto max-content [col-end];
    }

    &.opposed-rune {
      grid-template-columns: [col-start] max-content auto max-content min-content max-content auto max-content [col-end];
    }
  }

  .experienced {
    text-shadow: 0 0 0.5em red, 0 0 1.5em yellow;
  }

  [data-characteristic-roll],
  [data-damage-roll],
  [data-item-roll],
  [data-item-equipped-toggle],
  [data-item-heal-wound],
  [data-item-add-wound],
  [data-journal-id],
  [data-weapon-roll],
  [data-reputation-roll],
  [data-rune-magic-roll] {
    &:hover {
      box-shadow: 12px 12px 16px 0 rgba(0, 0, 0, 0.25), -8px -8px 12px 0 rgba(255, 255, 255, 0.3);
    }

    &:active {
      box-shadow: -8px -8px 16px 0 rgba(0, 0, 0, 0.25), 11px 12px 12px 0 rgba(255, 255, 255, 0.3),
        inset 4px 4px 5px 0px rgba(0, 0, 0, 0.25);
    }
  }

  .contextmenu {
    cursor: context-menu;
  }

  [data-journal-id] {
    cursor: help;
  }

  #context-menu {
    width: fit-content;
    font-size: 14px;
    cursor: default;
    text-align: left;
    text-shadow: initial;

    font-family: "Signika", sans-serif;
    font-variant: normal;
    letter-spacing: normal;
    font-weight: normal;
    ol {
      padding-top: 5px;
      padding-bottom: 5px;
      padding-right: 5px;
    }
    li.context-item {
      white-space: nowrap;
      padding-top: 3px;
      .context-icon {
        fill: white;
        width: 30px;
        display: inline-block;
        text-align: center;
        position: relative;
        left: -3px;
        bottom: -4px;
        filter: invert(1);
      }
      .context-icon-img {
        height: 16pt;
      }
    }
  }

  &.sheet {
    backdrop-filter: blur(2px);
  }

  .sheet-body {
    .tab {
      height: 100%;
    }
  }

  .editor {
    margin-top: 10px;
  }

  .editor,
  .editor-content {
    min-height: 5rem;
    width: 100%;
    box-shadow: var(--rqg-box-shadow-editor-content);
  }

  /* Items List */
  .item-list {
    list-style: none;
    margin: 7px 0;
    padding: 0;
  }

  &.chat-card {
    .card-options {
      margin: 10px 0 0 0;
      background: url(./assets/images/ui/mainbackground.webp) repeat-y scroll top left/100%;
    }

    .card-option {
      margin: 5px;
    }

    &.weapon-card {
      .active {
        box-shadow: 0 0 0.5em red;
      }
      h3 {
        margin-bottom: -6px;
      }
      input[type="submit"] {
        margin-top: 5px;
      }
      .damage {
        writing-mode: tb;
        transform: rotate(180deg);
        height: min-content;
        margin-right: 3px;
        margin-left: -4px;
      }

      [name="combatManeuver"] {
        width: min-content;
        flex: 1 1 auto;
      }
    }
    &.characteristic-card {
      .multiplier {
        font-size: 80%;
        vertical-align: text-top;
      }
    }
    .chat-select-wide {
      width: 100%;
    }
  }

  &.dialog.heal-wound {
    .woundlist label {
      padding-right: 5px;
    }
  }

  .card-journal-link {
    .invalid {
      color: var(--rqg-color-invalid-journal);
    }
  }

  .card-number-input {
    text-align: right;
    width: 50px;
  }
}

.rqg.character {
  .profile-img {
    height: 117px;
    transform: rotate(5deg);
    box-shadow: var(--rqg-box-shadow-profile-img);
    border-radius: 10px;

    &.unset {
      height: 20px;
      flex: 0 0 20px;
    }
  }

  .mainbackground {
    grid-area: -1 / 2 / 1 / -1; // TODO define by area name instead
    background: url(./assets/images/ui/mainbackground.webp) repeat-y scroll top left/100%;
  }

  .window-content {
    padding: 0;
    background: none;

    form {
      display: grid;
      grid-template-columns: min-content auto;
      grid-template-areas:
        "nav header"
        "nav main";
      grid-template-rows: min-content 1fr;
    }

    .sheet-header {
      grid-area: header;
      padding: 8px 4%;
      align-items: start;
      height: fit-content;
    }

    .navbackground {
      grid-area: nav;
      height: 100%;
      width: 100%;
    }

    nav.sheet-tabs {
      grid-area: nav;
      flex-direction: row;
      border: none;
      padding: 8px 0;
      margin: 0;
      display: block;
      line-height: 20px;

      .item {
        white-space: nowrap;
        color: white;
        writing-mode: vertical-rl;
        transform: rotate(180deg) translateX(-4px);
        padding: 10px 0;
        font-size: 13px;
        font-variant-caps: normal;

        &.active {
          text-shadow: 0 0 3px black, -2px -2px 3px black;
          color: white;
          font-weight: bold;
        }

        &.active::before {
          content: "";
          position: absolute;
          top: 0;
          bottom: 0;
          left: -6px;
          right: -6px;
          z-index: -1;
          border-radius: 50% 23% 25% 50% / 16% 35% 37% 50%;
          box-shadow: var(--rqg-box-shadow-tab-active);
          background: var(--rqg-background-tab-active);
          background-blend-mode: screen, difference;
        }
      }
    }

    nav.gear-tabs {
      flex: none;

      img {
        height: 15px;
      }

      .item {
        flex: min-content;
        padding-left: 5px;
        padding-right: 5px;

        &.active,
        &:hover {
          box-shadow: 0 0 10px red;
        }
      }
    }

    .sheet-body {
      grid-area: main;
      padding: 8px 4%;
    }
  }

  .topheaderline {
    display: flex;
    justify-content: space-between;

    * {
      margin: 0;
    }

    .mp {
      font-weight: bold;

      input {
        width: 25px;
        font-family: "Signika", sans-serif;
      }
    }

    .mp {
      margin-left: 40px;
    }

    input[name="name"] {
      background-color: transparent;
      border: none;
      font-size: 35px;
      font-weight: bold;
    }
  }

  .characteristics {
    display: flex;
    justify-content: space-between;

    div {
      text-align: center;
    }

    .value {
      font-size: 23px;
    }

    label {
      font-size: 23px;
      font-weight: bold;
    }

    input {
      border: none;
      background-color: transparent;
      font-size: 25px;
      width: 100%;

      &:focus {
        border: 1px solid grey;
        background-color: var(--color-text-light-highlight);
      }

      &[type="text"] {
        font-size: 12px;
        margin-top: -4px;
      }
    }
  }

  img {
    border: none;
  }

  .thirdline {
    display: flex;
    gap: 1rem;
    justify-content: space-between;
    align-items: center;
    margin-top: 8px;

    .norse {
      font-weight: bold;
    }
  }

  input {
    width: initial;
  }

  .background label {
    line-height: 2rem;
  }

  ul.location {
    list-style: none;
    padding: 0;
  }

  .location {
    ul {
      list-style: none;

      &.container {
        border-top: 3px solid var(--color-underline-header);
        border-left: 3px solid var(--color-underline-header);
        margin-top: 5px;
        padding-top: 5px;
        font-style: normal;
        background-color: var(--rqg-table-alternate-background);
      }
    }

    .virtual {
      font-style: italic;
    }
  }

  .grid.location-row {
    display: grid;
    grid-template-columns: auto min-content max-content min-content;

    i {
      color: var(--color-underline-header);
      margin-right: 5px;
      position: relative;
      bottom: -7px;
      left: -2px;
      height: 100%;
      text-align: center;
    }
  }
}

.rqg.sheet {
  input {
    width: inherit;
  }

  // &.skill,
  // &.armor,
  // &.passion,
  // &.rune {
  //   div.paren-head {
  //     display: inline-flex;
  //     align-items: center;
  //   }
  //   fieldset {
  //     display: flex;
  //   }
  //   .paren-head {
  //     margin-left: 0.5rem;
  //   }
  //   label {
  //     white-space: nowrap;
  //     margin-right: 0.6rem;
  //   }
  // }
}

.rqg img.rune {
  height: 20px;
  border: none;
  margin: 0;
  mix-blend-mode: overlay;
}

.rqg img.rune-dark {
  height: 20px;
  border: none;
  margin: 0;
}

.rqg img.item {
  height: 26px;
  border: none;
  vertical-align: inherit;
}

.rqg.sheet img.equipped-status {
  height: 15px;
  margin: 0;
}

.token-initiative input {
  color: white;
}

.app {
  &.sheet.journal-sheet {
    font-size: 16px;

    h3,
    h4 {
      margin: 0 0 -0.5rem;
    }
  }

  input[name="hitLocationItemNames"] {
    min-width: 10rem;
  }
}

.app.default-icons {
  label {
    display: flex;

    span {
      flex: 1;
    }

    img {
      height: 26px;
      border: none;
      vertical-align: inherit;
    }

    .file-picker {
      width: min-content;
    }

    input {
      width: 22rem;
    }
  }
}

#pause {
  background: none;

  h3 {
    font-size: 3rem;
    text-shadow: 1px 1px 2px var(--rqg-color-main), 0 0 1em var(--rqg-color-main-bg),
      0 0 0.2em var(--rqg-color-main-bg);
  }
}

// Tabbed Navigation for Item Sheets

.tabs {
  border-top: 1px solid #aaa;
  border-bottom: 1px solid #aaa;

  .item {
    font-weight: bold;
    white-space: nowrap;
  }

  .item.active {
    background-color: black;
    color: white;
  }

  .item.wider {
    flex: 1.3 1 0;
  }

  .item.narrower {
    flex: 0.7 1 0;
  }
}

.item-sheet-properties {
  display: grid;
  grid-template-columns: 1fr 2fr;
  grid-gap: 0.5em;
  align-items: center;
  padding: 0 0 0.5em 0;

  & .editor-label,
  & .editor-container {
    text-align: start;
    grid-column: 1 / 3;
  }  
}

.item-sheet-properties label {
  font-weight: bold;
  display: block;
  text-align: right;
}

.item-sheet-properties input[type="number"] {
  text-align: right;
  width: 75px;
}

.item-sheet-properties input.short {
  width: 75px;
}

.item-sheet-properties span.number {
  text-align: right;
  width: 75px;
}

.item-sheet-properties div.rune-property {
  display: grid;
  grid-template-columns: 1fr 5fr;
  grid-gap: 0.5em;

  & img {
    mix-blend-mode: normal;
  }
}

.item-sheet-journal-link {
  display: block;
}

.item-sheet-journal-link i.fa-info-circle {
  padding: 0 0 0 7px;
}

.item-sheet-header {
  display: grid;
  grid-template-columns: 6rem auto;
  grid-gap: 0.5em;
  align-items: center;
  padding: 0 0 0.5em 0;
}

.item-sheet-header-img {
  // width: 6rem;
  grid-row: 1 / 3;
}

.item-sheet-header .name-number {
  display: grid;
  grid-template-columns: auto 75px;
  align-items: center;
  grid-gap: 0.5em;
}

.item-sheet-header .name-parts-3 {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  align-items: center;
  grid-gap: 0.5em;
}

.item-sheet-header .name-parts-2 {
  display: grid;
  grid-template-columns: 2fr 1fr;
  align-items: center;
  grid-gap: 0.5em;
}

// .item-sheet-header-name label {
//   display: block;
// }

.name-number input[type="text"],
.name-parts-3 input[type="text"],
.name-parts-2 input[type="text"] {
  width: -webkit-fill-available;
}

.paren-head {
  align-items: center;
}

.paren-head label {
  margin-left: 0.5rem;
}

.paren-head div {
  display: inline-flex;
  align-items: center;
}

.paren-head input[type="text"],
.paren-head select {
  text-align: center;
  width: 90%;
  margin: 0.25rem;
}

.paren-head input[type="number"] {
  text-align: center;
  width: 50px;
  margin: 0.25rem;
}
